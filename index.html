<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Token Factory</title>
  <script src="https://unpkg.com/@solana/web3.js@1.87.0/lib/index.iife.js"></script>
  <style>
    body { margin:0; font-family: Arial, sans-serif; background:#000; color:#fff; }
    header { padding:20px; text-align:center; background:#111; }
    h1 { margin:0; }
    main { max-width:600px; margin:40px auto; padding:20px; background:#111; border-radius:10px; }
    label { display:block; margin-top:15px; font-weight:bold; }
    input { width:100%; padding:10px; border-radius:8px; border:none; margin-top:5px; }
    button { margin-top:20px; width:100%; padding:12px; border:none; border-radius:8px; background:#4caf50; color:#fff; font-size:16px; cursor:pointer; }
    button:hover { background:#45a049; }
    #log { margin-top:20px; padding:10px; background:#000; border-radius:8px; min-height:120px; white-space:pre-line; }
  </style>
</head>
<body>
  <header>
    <h1>Token Factory - Crear Token en Solana</h1>
  </header>

  <main>
    <label>Nombre del Token</label>
    <input id="tokenName" type="text" placeholder="Ej: RoadCoin" />

    <label>Símbolo</label>
    <input id="tokenSymbol" type="text" placeholder="Ej: RDC" />

    <label>Decimales</label>
    <input id="tokenDecimals" type="number" min="0" max="9" value="9" />

    <label>Suministro Total</label>
    <input id="tokenSupply" type="number" placeholder="Ej: 1000000" />

    <button onclick="crearToken()">Crear Token</button>

    <div id="log"></div>
  </main>

<script>
const { Connection, Keypair, PublicKey, SystemProgram, Transaction } = solanaWeb3;

function log(msg){
  document.getElementById("log").innerText += `\n${msg}`;
}

async function crearToken(){
  document.getElementById("log").innerText = "";
  log("Conectando a Phantom...");

  if(!window.solana){
    log("Phantom no está instalado.");
    return;
  }

  await window.solana.connect();
  const wallet = window.solana;
  const publicKey = wallet.publicKey;

  log("Wallet conectada: " + publicKey.toString());

  const connection = new Connection("https://api.mainnet-beta.solana.com", "confirmed");

  const name = document.getElementById("tokenName").value;
  const symbol = document.getElementById("tokenSymbol").value;
  const decimals = parseInt(document.getElementById("tokenDecimals").value);
  const supply = parseInt(document.getElementById("tokenSupply").value);

  if(!name || !symbol || !supply){
    log("Por favor complete todos los campos.");
    return;
  }

  log("Creando token...");

  try{
    const mintAccount = Keypair.generate();

    const lamportsForMint = await connection.getMinimumBalanceForRentExemption(82);

    const createMintTx = new Transaction().add(
      SystemProgram.createAccount({
        fromPubkey: publicKey,
        newAccountPubkey: mintAccount.publicKey,
        space: 82,
        lamports: lamportsForMint,
        programId: new PublicKey("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA")
      })
    );

    createMintTx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;
    createMintTx.feePayer = publicKey;

    const signed = await wallet.signTransaction(createMintTx);
    signed.partialSign(mintAccount);

    const txid = await connection.sendRawTransaction(signed.serialize());

    await connection.confirmTransaction(txid);

    log("Token creado con éxito!");
    log("Mint Address: " + mintAccount.publicKey.toString());

    log("\n*** IMPORTANTE ***\nEste es un ejemplo mínimo. Para un token funcional necesitas usar SPL Token Program v2, asociar cuenta ATA y mintear supply.");

  }catch(err){
    log("ERROR: " + err);
  }
}
</script>
</body>
</html>
