<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Token Factory</title>

  <style>
    body {
      margin: 0;
      font-family: Arial, sans-serif;
      background: #000;
      color: white;
    }

    header {
      width: 100%;
      padding: 20px;
      display: flex;
      justify-content: space-between;
      align-items: center;
      position: fixed;
      top: 0;
      background: rgba(0,0,0,0.8);
      backdrop-filter: blur(6px);
      z-index: 100;
    }

    .logo {
      font-size: 28px;
      font-weight: bold;
      color: #ff0000;
    }

    .btn {
      padding: 10px 16px;
      border: none;
      cursor: pointer;
      font-size: 15px;
      border-radius: 6px;
      transition: 0.2s;
    }

    .btn-primary {
      background: #ff0000;
      color: white;
    }
    .btn-primary:hover { 
      background: #cc0000;
      transform: scale(1.05);
    }

    .btn-error {
      background: #444;
      color: #ff0000;
      border: 1px solid #ff0000;
    }
    .btn-error:hover { 
      background: #770000;
      transform: scale(1.05);
    }

    .main {
      margin-top: 150px;
      text-align: center;
      padding: 20px;
    }

    h1 {
      font-size: 50px;
      color: #ff0000;
    }

    p {
      font-size: 20px;
      margin-top: -10px;
      color: #ccc;
    }

    /* NOTIFICACIONES */
    #notif {
      position: fixed;
      top: 20px;
      right: 20px;
      background: #111;
      border-left: 5px solid #ff0000;
      padding: 15px 20px;
      border-radius: 8px;
      color: white;
      opacity: 0;
      transform: translateY(-20px);
      transition: 0.3s ease;
      z-index: 200;
      font-size: 16px;
      pointer-events: none;
    }

    #notif.show {
      opacity: 1;
      transform: translateY(0);
    }

    /* MODAL CREAR TOKEN */
    #tokenModal {
      display: none;
      position: fixed;
      top:0;
      left:0;
      width:100%;
      height:100%;
      background:rgba(0,0,0,0.85);
      backdrop-filter: blur(6px);
      justify-content:center;
      align-items:center;
      z-index:300;
    }

    #tokenModalContent {
      background:#111;
      padding:30px;
      border-radius:10px;
      width:350px;
      text-align:center;
      position:relative;
    }

    #tokenModalContent h2 {
      color:#ff0000;
      margin-bottom:20px;
    }

    #tokenModalContent input {
      width:100%;
      padding:10px;
      margin-bottom:10px;
      border-radius:6px;
      border:none;
      outline:none;
    }

    #tokenModalContent button {
      width:100%;
      margin-top:10px;
    }

  </style>
</head>

<body>

  <!-- NOTIFICACI√ìN -->
  <div id="notif"></div>

  <!-- HEADER -->
  <header>
    <div class="logo">TOKEN FACTORY</div>

    <button 
      id="walletBtn"
      class="btn btn-primary"
      onclick="connectWallet()"
    >
      Conectar wallet
    </button>
  </header>

  <!-- CONTENIDO -->
  <div class="main">
    <h1>Crea tokens en Solana</h1>
    <p>Simple, r√°pido y en mainnet</p>

    <button 
      id="openCreateToken"
      class="btn btn-primary"
      style="margin-top:30px"
    >
      Crear token
    </button>
  </div>

  <!-- MODAL CREAR TOKEN -->
  <div id="tokenModal">
    <div id="tokenModalContent">
      <h2>Crear Token</h2>
      <input id="tokenName" placeholder="Nombre del token" />
      <input id="tokenSymbol" placeholder="S√≠mbolo (ej: TKN)" />
      <input id="tokenDecimals" type="number" placeholder="Decimales (ej: 9)" />
      <input id="tokenSupply" type="number" placeholder="Cantidad total" />
      <button id="createTokenBtn" class="btn btn-primary">Crear Token</button>
      <button id="closeTokenModal" class="btn btn-error">Cancelar</button>
    </div>
  </div>

  <!-- LIBRERIAS SOLANA -->
  <script src="https://cdn.jsdelivr.net/npm/@solana/web3.js@latest/lib/index.iife.min.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@solana/spl-token@latest/lib/index.iife.min.js"></script>

  <!-- SCRIPT -->
  <script>
    let walletConnected = false;
    let walletAddress = "";

    function showNotif(msg) {
      const n = document.getElementById('notif');
      n.innerText = msg;
      n.classList.add("show");
      setTimeout(() => n.classList.remove("show"), 2500);
    }

    // Al cargar la p√°gina, revisa si Phantom ya est√° conectada
    document.addEventListener("DOMContentLoaded", async () => {
      const provider = window.solana;

      if (provider && provider.isPhantom) {
        try {
          const resp = await provider.connect({ onlyIfTrusted: true });

          if (resp.publicKey) {
            walletConnected = true;
            walletAddress = resp.publicKey.toString();
            updateWalletButton();
            showNotif("‚úÖ Wallet conectada autom√°ticamente");
          }
        } catch (err) {
          console.warn("No hay conexi√≥n previa:", err);
        }
      }
    });

    // Actualiza el bot√≥n seg√∫n el estado
    function updateWalletButton() {
      const btn = document.getElementById("walletBtn");
      if (walletConnected) {
        const shortAddr = walletAddress.slice(0,6) + "..." + walletAddress.slice(-4);
        btn.innerText = shortAddr;
        btn.classList.remove("btn-primary");
        btn.classList.add("btn-error");
      } else {
        btn.innerText = "Conectar wallet";
        btn.classList.remove("btn-error");
        btn.classList.add("btn-primary");
      }
    }

    async function connectWallet() {
      const provider = window.solana;
      if (!provider || !provider.isPhantom) {
        showNotif("Instala Phantom para continuar");
        return;
      }

      try {
        if (!walletConnected) {
          const resp = await provider.connect();
          walletConnected = true;
          walletAddress = resp.publicKey.toString();
          updateWalletButton();
          showNotif("‚úÖ La wallet se conect√≥ correctamente");
        } else {
          await provider.disconnect();
          walletConnected = false;
          walletAddress = "";
          updateWalletButton();
          showNotif("üîå Wallet desconectada");
        }
      } catch (err) {
        console.error(err);
        showNotif("‚ö†Ô∏è Error: " + (err.message || err));
      }
    }

    // ABRIR MODAL
    document.getElementById("openCreateToken").addEventListener("click", () => {
      if (!walletConnected) {
        showNotif("‚ö†Ô∏è Conecta tu wallet primero");
        return;
      }
      document.getElementById("tokenModal").style.display = "flex";
    });

    // CERRAR MODAL
    document.getElementById("closeTokenModal").addEventListener("click", () => {
      document.getElementById("tokenModal").style.display = "none";
    });

    // CREAR TOKEN
    document.getElementById("createTokenBtn").addEventListener("click", async () => {
      const name = document.getElementById("tokenName").value.trim();
      const symbol = document.getElementById("tokenSymbol").value.trim();
      const decimals = parseInt(document.getElementById("tokenDecimals").value);
      const supply = parseFloat(document.getElementById("tokenSupply").value);

      if (!name || !symbol || isNaN(decimals) || isNaN(supply)) {
        showNotif("‚ö†Ô∏è Completa todos los campos correctamente");
        return;
      }

      document.getElementById("tokenModal").style.display = "none";
      showNotif("‚è≥ Creando token, espera...");

      try {
        const connection = new solanaWeb3.Connection(solanaWeb3.clusterApiUrl('mainnet-beta'));
        const wallet = window.solana;
        const fromPubkey = wallet.publicKey;

        const mint = await splToken.Token.createMint(
          connection,
          wallet,
          fromPubkey,
          null,
          decimals,
          splToken.TOKEN_PROGRAM_ID
        );

        const fromTokenAccount = await mint.getOrCreateAssociatedAccountInfo(fromPubkey);

        await mint.mintTo(
          fromTokenAccount.address,
          fromPubkey,
          [],
          supply * (10 ** decimals)
        );

        showNotif(`‚úÖ Token creado: ${symbol}`);
      } catch (err) {
        console.error(err);
        showNotif("‚ö†Ô∏è Error al crear token: " + err.message);
      }
    });

  </script>

</body>
</html>
