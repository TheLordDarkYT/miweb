<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Token Factory</title>

  <!-- Solana web3 -->
  <script src="https://unpkg.com/@solana/web3.js@1.87.0/lib/index.iife.js"></script>

  <!-- Tu CSS externo -->
  <link rel="stylesheet" href="style.css" />
</head>

<body>

  <!-- HEADER -->
  <header>
    <div class="logo">TOKEN FACTORY</div>
    <nav>
      <a href="/">Inicio</a>
      <a href="/create">Crear Token</a>
    </nav>
  </header>

  <!-- HERO -->
  <section class="hero">
    <h1>Crea tokens en Solana</h1>
    <p>Simple, rápido y directamente en mainnet</p>
    <a href="#form" class="btn">Crear Token</a>
  </section>

  <!-- FORMULARIO -->
  <main id="form" style="max-width:600px; margin:40px auto; padding:20px; backdrop-filter: blur(4px); background: rgba(0,0,0,0.55); border:1px solid red; border-radius:10px;">
    <label>Nombre del Token</label>
    <input id="tokenName" type="text" placeholder="Ej: RoadCoin" />

    <label>Símbolo</label>
    <input id="tokenSymbol" type="text" placeholder="Ej: RDC" />

    <label>Decimales</label>
    <input id="tokenDecimals" type="number" min="0" max="9" value="9" />

    <label>Suministro Total</label>
    <input id="tokenSupply" type="number" placeholder="Ej: 1000000" />

    <button onclick="crearToken()">Crear Token</button>

    <div id="log" style="background:#000; margin-top:20px; padding:10px; border-radius:8px; min-height:120px; white-space:pre-line;"></div>
  </main>

  <footer>
    © 2025 Token Factory - Powered on Solana
  </footer>


<script>
const { Connection, Keypair, PublicKey, SystemProgram, Transaction } = solanaWeb3;

function log(msg){
  document.getElementById("log").innerText += `\n${msg}`;
}

async function crearToken(){
  document.getElementById("log").innerText = "";
  log("Conectando a Phantom...");

  if(!window.solana){
    log("Phantom no está instalado.");
    return;
  }

  await window.solana.connect();
  const wallet = window.solana;
  const publicKey = wallet.publicKey;

  log("Wallet conectada: " + publicKey.toString());

  const connection = new Connection("https://api.mainnet-beta.solana.com", "confirmed");

  const name = document.getElementById("tokenName").value;
  const symbol = document.getElementById("tokenSymbol").value;
  const decimals = parseInt(document.getElementById("tokenDecimals").value);
  const supply = parseInt(document.getElementById("tokenSupply").value);

  if(!name || !symbol || !supply){
    log("Por favor complete todos los campos.");
    return;
  }

  log("Creando token...");

  try{
    const mintAccount = Keypair.generate();

    const lamportsForMint = await connection.getMinimumBalanceForRentExemption(82);

    const createMintTx = new Transaction().add(
      SystemProgram.createAccount({
        fromPubkey: publicKey,
        newAccountPubkey: mintAccount.publicKey,
        space: 82,
        lamports: lamportsForMint,
        programId: new PublicKey("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA")
      })
    );

    createMintTx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;
    createMintTx.feePayer = publicKey;

    const signed = await wallet.signTransaction(createMintTx);
    signed.partialSign(mintAccount);

    const txid = await connection.sendRawTransaction(signed.serialize());

    await connection.confirmTransaction(txid);

    log("Token creado con éxito!");
    log("Mint Address: " + mintAccount.publicKey.toString());
    log("\n*** IMPORTANTE ***\nEste es un ejemplo mínimo. Para un token funcional necesitas usar SPL Token v2, ATA y minteo.");

  }catch(err){
    log("ERROR: " + err);
  }
}
</script>

</body>
</html>
