<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Token Factory</title>

  <link rel="stylesheet" href="style.css">

  <script src="https://unpkg.com/@solana/web3.js@1.87.0/lib/index.iife.js"></script>
</head>

<body>

<header>
  <div class="logo">TOKEN FACTORY</div>
  <nav>
    <a href="index.html">Inicio</a>
    <a href="#crear">Crear Token</a>
  </nav>
</header>

<!-- HERO -->
<section class="hero">
  <h1>Crea tokens en Solana</h1>
  <p>Simple, rápido y en mainnet</p>
  <a class="btn" href="#crear">Crear token</a>
</section>

<!-- FORMULARIO -->
<main id="crear">
  <div class="form-box">
    <label>Nombre del Token</label>
    <input id="tokenName" type="text" placeholder="Ej: RoadCoin" />

    <label>Símbolo</label>
    <input id="tokenSymbol" type="text" placeholder="Ej: RDC" />

    <label>Decimales</label>
    <input id="tokenDecimals" type="number" min="0" max="9" value="9" />

    <label>Suministro Total</label>
    <input id="tokenSupply" type="number" placeholder="Ej: 1000000" />

    <button onclick="crearToken()">Crear Token</button>

    <div id="log" class="log-box"></div>
  </div>
</main>

<footer>
  © 2025 Token Factory - Powered on Solana
</footer>

<script>
const { Connection, Keypair, PublicKey, SystemProgram, Transaction } = solanaWeb3;

function log(msg){
  document.getElementById("log").innerText += `\n${msg}`;
}

async function crearToken(){
  document.getElementById("log").innerText = "";
  log("Conectando a Phantom...");

  if(!window.solana){
    log("Phantom no está instalado.");
    return;
  }

  await window.solana.connect();
  const wallet = window.solana;
  const publicKey = wallet.publicKey;

  log("Wallet conectada: " + publicKey.toString());

  const connection = new Connection("https://api.mainnet-beta.solana.com", "confirmed");

  const name = document.getElementById("tokenName").value;
  const symbol = document.getElementById("tokenSymbol").value;
  const decimals = parseInt(document.getElementById("tokenDecimals").value);
  const supply = parseInt(document.getElementById("tokenSupply").value);

  if(!name || !symbol || !supply){
    log("Por favor complete todos los campos.");
    return;
  }

  log("Creando token...");

  try{
    const mintAccount = Keypair.generate();

    const lamportsForMint = await connection.getMinimumBalanceForRentExemption(82);

    const createMintTx = new Transaction().add(
      SystemProgram.createAccount({
        fromPubkey: publicKey,
        newAccountPubkey: mintAccount.publicKey,
        space: 82,
        lamports: lamportsForMint,
        programId: new PublicKey("TokenkegQfeZyiNwAJbNbGKPFXCWuBvf9Ss623VQ5DA")
      })
    );

    createMintTx.recentBlockhash = (await connection.getLatestBlockhash()).blockhash;
    createMintTx.feePayer = publicKey;

    const signed = await wallet.signTransaction(createMintTx);
    signed.partialSign(mintAccount);

    const txid = await connection.sendRawTransaction(signed.serialize());

    await connection.confirmTransaction(txid);

    log("Token creado con éxito!");
    log("Mint Address: " + mintAccount.publicKey.toString());

    log("\n*** IMPORTANTE ***\nEste es un ejemplo mínimo. Para un token funcional necesitas usar SPL Token Program v2, asociar cuenta ATA y mintear supply.");

  }catch(err){
    log("ERROR: " + err);
  }
}
</script>

</body>
</html>

